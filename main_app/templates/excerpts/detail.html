{%extends 'base.html'%} {%block content%}
<a href="{%url 'audition_detail' excerpt.audition_id%}">
  Back to the audition page
</a>
<div class="card">
  <h3>{{excerpt.title}} - {{excerpt.composer}}</h3>
  <h4>{{excerpt.section}}</h4>
  {% if excerpt.practiced_today %}
  <h5>yay you practiced me today</h5>
  {%else%}
  <form action="{%url 'excerpt_practiced' excerpt.id%}" method="POST">
    {%csrf_token%}
    <input type="submit" value="I practiced this today!" />
  </form>
  {%endif%}
  {% if excerpt.goal_tempo_type and  excerpt.goal_tempo_bpm%}
  <p>Goal Tempo: {{excerpt.goal_tempo_bpm}}</p>
  {%else%}
  <p>No goal tempo set yet :(</p>
  {%endif%}
  {%if excerpt.last_practiced and not excerpt.practiced_today%}
  <p>Last practiced on {{excerpt.last_practiced}}</p>
  {%endif%}
  
  
  <form action="{%url 'excerpt_current-tempo' excerpt.id%}" method="POST">
    {%csrf_token%}
    <label for="current-tempo">Current Tempo (enter to submit)</label>
    <input type="number" id="current-tempo" name="current-tempo" value={{excerpt.current_tempo}} />
  </form>

  {%for link in links%}
  <iframe
    style="border-radius: 12px"
    id="embed-iframe"
    src="{{link.url}}"
    width="100%"
    height="152"
    frameborder="0"
    allowfullscreen=""
    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
    loading="lazy"
  ></iframe>
  <p>{{link.start}}</p>

  {%empty%} 
  <h6>Click Edit to link a recording from Spotify here</h6>
  
  {%endfor%}
  {%if excerpt.score_url%}
  {%if excerpt.score_type == 'pdf'%}
  <iframe 
  sandbox="allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-presentation allow-same-origin allow-scripts allow-top-navigation allow-top-navigation-by-user-activation"
  class='card-panel materialboxed no-click' src="http://docs.google.com/gview?url={{excerpt.score_url}}&embedded=true" style="width: 170px; height:220px;" frameborder="0"></iframe>
  <p>click border to expand</p>
  {%else%}
      <img class="responsive-img card-panel materialboxed" width="20%" height="auto" src="{{excerpt.score_url}}">
      {%endif%}
{%else%}
<div class="card-panel teal-text center-align">No Score Uploaded</div>
{%endif%}
    <form action="{% url 'add_score' excerpt.id %}" enctype="multipart/form-data" method="POST" class="card-panel">
      {% csrf_token %}
      <input type="file" name="photo-file">
      <p>Only image files (no pdfs) for now</p>
      <br><br>
      {%if excerpt.score_url%}
      <button type="submit" class="btn">Upload New Score</button>
      {%else%}
      <button type="submit" class="btn">Upload Score</button>
      {%endif%}
  </form>
{%if comp_obj%}
  <h4>{{comp_obj.complete_name}}</h4>
  <h6>{{comp_obj.epoch}}</h6>
  <p>{{comp_obj.birth}} - {{comp_obj.death}}
<img src="{{comp_obj.portrait}}" />
{%endif%}
</div>
<a href="{%url 'excerpt_delete' excerpt.id excerpt.audition_id%}">
  <button>X</button>
</a>
<a href="{%url 'excerpt_update' excerpt.id%}">
  <button>EDIT</button>
</a>
<hr />


<hr>
<h1>NOTES</h1>
<div class="card">
  <form
    action="{%url 'note_create' excerpt.id%}"
    method="POST"
    enctype="multipart/form-data"
  >
    {% csrf_token %} {{note_form.as_p}}
    <input type="submit" value="Add Note" />
  </form>
</div>
{%for note in notes%}
<div class="card">
  <h4>{{note.date}}</h4>
  <p>{{note.note}}</p>
  <a href="{%url 'note_update' note.id%}">
    <button>EDIT</button>
  </a>
  <form action="{%url 'note_delete' note.id excerpt.id%}" method="POST">
    {% csrf_token %}
    <input type="submit" value="X" />
  </form>
</div>
{%endfor%} 
{% comment %} <button id="test-btn">test</button>
<button id="togglePlay">test</button>
<button id="seek">seek 30</button> {% endcomment %}
<script> 
  testEl = document.getElementById('test-btn')
  {% comment %} window.onSpotifyIframeApiReady = (IFrameAPI) => {
    const element = document.getElementById('embed-iframe');
    const options = {
        uri: 'https://open.spotify.com/track/1eT1nYXFxxvz87hco27mgj?si=a86f28ccb8344cde'
      };
      const callback = (EmbedController) => {
        testEl.addEventListener('click', ()=> EmbedController.play())
        testEl.addEventListener('click', ()=> EmbedController.seek(20))
        //testEl.addEventListener('click', ()=> EmbedController.togglePlay())
      };
      IFrameAPI.createController(element, options, callback);
    }; {% endcomment %}
{% comment %} 

  window.onSpotifyWebPlaybackSDKReady = () => {
    const token = "BQBjpvOAJjxdu_7etrYQglB65jzz08tOVDMzOaMiTMeY8R5LjlUuNKb_5-f2buzoXXBIaT7l1g2RGrjwJk6Cbt1tSVvA_c6xxlkbAlnfzN5IzwBO1_zLPNLsBWJ1VXjgNTJjGKfpcUO8aXyXcqZhPlJem9rvfUZhXJKf905jvylydWkiJvk0JNsAEI3n9rhGFkKY93GH"
    const player = new Spotify.Player({
      name: 'Audition Assistant',
      getOAuthToken: cb => { cb(token); },
      volume: 0.5
    });
// Ready
player.addListener('ready', ({ device_id }) => {
  console.log('Ready with Device ID', device_id);
});

// Not Ready
player.addListener('not_ready', ({ device_id }) => {
  console.log('Device ID has gone offline', device_id);
});

player.addListener('initialization_error', ({ message }) => {
  console.error(message);
});

player.addListener('authentication_error', ({ message }) => {
  console.error(message);
});

player.addListener('account_error', ({ message }) => {
  console.error(message);
});

document.getElementById('togglePlay').onclick = function() {
console.log(player)
  player.togglePlay();
};
document.getElementById('seek').onclick = function() {
console.log(player)
  player.seek(30000);
};

player.connect();
} {% endcomment %}
</script> 



{%endblock%}
